
<?php
include_once "dbCon.php";

class Events_DB extends DB_connection{
	
	public function __construct(){
                parent::__construct();
        }
	
	/*
	*for creating users
	*@input=> username:string, passwd:string, email:string, gToken:string
	*@output=> if query changed the database:bool
	*/
	public function createUser($username, $passwd, $email){
		
		//encrypt password
		$passwd=md5($passwd);
		
		$stmt = $this->prepareSqlStmt( "INSERT INTO user (user_name, password, email) VALUES(?,?,?)");
		$stmt->bind_param('sss', $username,$passwd, $email);
		return $stmt->execute();
	}
	
	
	/*
	*for checking if a user name exists
	*@input=> username:string
	*@output=> if username exists:bool
	*/
	public function isUserExist($username){
		$stmt = $this->prepareSqlStmt( "SELECT COUNT(*) FROM user WHERE user_name=?");
		$stmt->bind_param('s', $username);
		$stmt->execute();
		$result=$stmt->get_result();
		$row = $result->fetch_row();
		if($row[0]==1){
			return true;
		}else{
			return false;
		}
	}
	
	/*
	*for checking if an email address exists
	*@input=> email address:string
	*@output=> if email address exists:bool
	*/
	public function isEmailExist($email){
		$stmt = $this->prepareSqlStmt( "SELECT COUNT(*) FROM user WHERE email=?");
		$stmt->bind_param('s', $email);
		$stmt->execute();
		$result=$stmt->get_result();
		$row = $result->fetch_row();
		if($row[0]==1){
			return true;
		}else{
			return false;
		}
	}
	
	
	/*
	*for checking if a user name exists
	*@input=> username:string, passwdHash:stirng
	*@output=> if username,passwdhash matches:bool
	*/
	public function authenticate($username,$passwdHash){
		$stmt = $this->prepareSqlStmt( "SELECT COUNT(*) FROM user WHERE user_name=? AND password=?");
		$stmt->bind_param('ss', $username,$passwdHash);
		$stmt->execute();
		$result=$stmt->get_result();
		$row = $result->fetch_row();
		if($row[0]==1){
			return true;
		}else{
			return false;
		}
	}
	
	/*
	*empty the events database
	*for testing only
	*/
	public function emptyDb(){
	        $stmt = $this->prepareSqlStmt( "DELETE FROM schedule");
		return $stmt->execute();
	}
}
?>
